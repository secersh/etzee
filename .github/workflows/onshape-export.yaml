name: ü§ñ Export 3D Models from Onshape

on:
  workflow_dispatch:
    
jobs:
  export-3D-models:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repo
        uses: actions/checkout@v4

      - name: Install yq
        run: |
          sudo apt-get update && sudo apt-get install -y yq

      - name: Get parts list
        run: |
          AUTH=$(echo -n "${{ secrets.ONSHAPE_API_ACCESS_KEY }}:${{ secrets.ONSHAPE_API_SECRET_KEY }}" | base64)

          echo $AUTH "üîç Fetching parts list from Onshape..."

          curl -X 'GET' \
          'https://cad.onshape.com/api/v10/parts/d/${{ vars.did }}/w/${{ vars.wvmid }}/e/${{ vars.eid }}?includeFlatParts=true' \
          -H 'Accept: application/json' \
          -H 'Authorization: Basic $AUTH'

      - name: Commit STL files
        run: |
          git config user.name "GitHub Actions"
          git config user.email "actions@github.com"
          git add manufacturing/3d-printing/*.stl
          git commit -m "Exported STL files from Onshape"
          git push
